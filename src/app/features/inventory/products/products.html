<section class="bg-gray-50 dark:bg-gray-900 p-3 sm:p-5">
    <div class="mx-auto max-w-screen-xl px-4 lg:px-12">
        <!-- Start coding here -->
        <div class="bg-white dark:bg-gray-800 relative shadow-md sm:rounded-lg overflow-hidden">
            <div class="flex flex-col md:flex-row items-center justify-between space-y-3 md:space-y-0 md:space-x-4 p-4">
                <div class="w-full md:w-1/2">
                    <h1 class="text-xl font-semibold text-gray-900 dark:text-white">Productos</h1>
                </div>
                <div
                    class="w-full md:w-auto flex flex-col md:flex-row space-y-2 md:space-y-0 items-stretch md:items-center justify-end md:space-x-3 flex-shrink-0">
                    <button type="button" (click)="openCreateModal()"
                        class="cursor-pointer flex items-center justify-center text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-4 py-2 dark:bg-primary-600 dark:hover:bg-primary-700 focus:outline-none dark:focus:ring-primary-800">
                        <svg class="h-3.5 w-3.5 mr-2" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path clip-rule="evenodd" fill-rule="evenodd"
                                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" />
                        </svg>
                        Agregar Producto
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="px-4 pb-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Búsqueda -->
                <div>
                    <label for="table-search" class="sr-only">Buscar</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor"
                                viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <input type="text" id="table-search" (input)="onSearchChange($event)" [value]="searchTerm"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full pl-10 p-2 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="Buscar productos..." />
                    </div>
                </div>

                <!-- Filtro Categoría -->
                <div>
                    <select (change)="onCategoryChange($event)" [value]="selectedCategory"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                        <option value="">Todas las categorías</option>
                        @for (category of categories; track category._id) {
                        <option [value]="category._id">{{ category.nombre }}</option>
                        }
                    </select>
                </div>

                <!-- Filtro Marca -->
                <div>
                    <select (change)="onBrandChange($event)" [value]="selectedBrand"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                        <option value="">Todas las marcas</option>
                        @for (brand of brands; track brand._id) {
                        <option [value]="brand._id">{{ brand.nombre }}</option>
                        }
                    </select>
                </div>

                <!-- Filtro Stock -->
                <div>
                    <select (change)="onStockStatusChange($event)" [value]="selectedStockStatus"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                        <option value="">Todos los estados</option>
                        <option value="in-stock">En Stock</option>
                        <option value="low-stock">Stock Bajo</option>
                        <option value="out-of-stock">Sin Stock</option>
                    </select>
                </div>
            </div>

            <!-- Tabla -->
            <div class="overflow-x-auto">
                @if (isLoading) {
                <div class="flex justify-center items-center px-4 py-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-700"></div>
                </div>
                } @else {
                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                        <tr>
                            <th scope="col" class="px-4 py-3">Imagen</th>
                            <th scope="col" class="px-4 py-3">Código</th>
                            <th scope="col" class="px-4 py-3">Nombre</th>
                            <th scope="col" class="px-4 py-3">Categoría</th>
                            <th scope="col" class="px-4 py-3">Marca</th>
                            <th scope="col" class="px-4 py-3">Precio</th>
                            <th scope="col" class="px-4 py-3">Stock</th>
                            <th scope="col" class="px-4 py-3">
                                <span class="sr-only">Acciones</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (getPaginatedProducts().length === 0) {
                        <tr>
                            <td colspan="8" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                                No se encontraron productos
                            </td>
                        </tr>
                        } @else {
                        @for (product of getPaginatedProducts(); track product._id + (product.imagen || '')) {
                        <tr class="border-b border-gray-200 dark:border-gray-700">
                            <td class="px-6 py-4">
                                @if (product.imagen && product.imagen !== '') {
                                <img [src]="product.imagen" [alt]="product.nombre"
                                    class="w-12 h-12 object-cover rounded"
                                    (error)="onImageError($event)" />
                                } @else {
                                <div
                                    class="w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded flex items-center justify-center">
                                    <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                }
                            </td>
                            <th scope="row" class="px-4 py-3 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                {{ product.codigo }}
                            </th>
                            <td class="px-4 py-3">
                                {{ product.nombre }}
                            </td>
                            <td class="px-4 py-3">
                                {{ getCategoryName(product.categoria) }}
                            </td>
                            <td class="px-4 py-3">
                                {{ getBrandName(product.marca) }}
                            </td>
                            <td class="px-4 py-3">
                                ${{ product.precio.toFixed(2) }}
                            </td>
                            <td class="px-4 py-3">
                                <span
                                    [class]="'inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ' + getStockStatus(product.stock).class">
                                    {{ getStockStatus(product.stock).text }}
                                </span>
                            </td>
                            <td class="px-4 py-3 flex items-center justify-end gap-2">
                                <button (click)="openEditModal(product)"
                                    class="cursor-pointer inline-flex items-center p-2 text-sm font-medium text-center text-gray-600 hover:text-primary-700 rounded-lg focus:outline-none dark:text-gray-400 dark:hover:text-primary-500"
                                    type="button">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z">
                                        </path>
                                        <path fill-rule="evenodd"
                                            d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                                <button (click)="deleteProduct(product._id!)"
                                    class="cursor-pointer inline-flex items-center p-2 text-sm font-medium text-center text-red-600 hover:text-red-700 rounded-lg focus:outline-none dark:text-red-500 dark:hover:text-red-600"
                                    type="button">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                            d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                        }
                        }
                    </tbody>
                </table>
                }
            </div>

            <!-- Paginación -->
            <nav class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-3 md:space-y-0 p-4"
                aria-label="Table navigation">
                <span class="text-sm font-normal text-gray-500 dark:text-gray-400">
                    Mostrando
                    <span class="font-semibold text-gray-900 dark:text-white">{{ (currentPage - 1) * itemsPerPage + 1
                        }}-{{ Math.min(currentPage * itemsPerPage, selectedStockStatus ? filteredProducts.length : totalItems) }}</span>
                    de
                    <span class="font-semibold text-gray-900 dark:text-white">{{ selectedStockStatus ? filteredProducts.length : totalItems }}</span>
                </span>
                <ul class="inline-flex items-stretch -space-x-px">
                    <li>
                        <button (click)="previousPage()" [disabled]="currentPage === 1"
                            class="cursor-pointer flex items-center justify-center h-full py-1.5 px-3 ml-0 text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="sr-only">Previous</span>
                            <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </li>
                    @for (page of getPageNumbers(); track page) {
                    <li>
                        <button (click)="goToPage(page)" 
                            [ngClass]="currentPage === page ? 
                                'bg-primary-700 text-white border-primary-700 dark:bg-primary-600 dark:border-primary-600' : 
                                'text-gray-500 bg-white border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white'"
                            class="cursor-pointer flex items-center justify-center text-sm py-2 px-3 leading-tight border">
                            {{ page }}
                        </button>
                    </li>
                    }
                    <li>
                        <button (click)="nextPage()" [disabled]="currentPage === totalPages"
                            class="cursor-pointer flex items-center justify-center h-full py-1.5 px-3 leading-tight text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="sr-only">Next</span>
                            <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</section>

<!-- Delete Confirmation Modal -->
<div id="deleteProductModal" tabindex="-1" aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-modal md:h-full">
    <div class="relative p-4 w-full max-w-md h-full md:h-auto">
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-800 p-4 md:p-6">
            <button type="button" (click)="closeDeleteModal()"
                class="cursor-pointer absolute top-3 end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-9 h-9 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white">
                <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M6 18 17.94 6M18 18 6.06 6" />
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="p-4 md:p-5 text-center">
                <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 13V8m0 8h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                <h3 class="mb-6 text-lg font-normal text-gray-500 dark:text-gray-400">
                    ¿Está seguro de eliminar este producto?
                </h3>
                <div class="flex items-center space-x-4 justify-center">
                    <button (click)="confirmDelete()" type="button"
                        class="cursor-pointer text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none dark:bg-red-500 dark:hover:bg-red-600 dark:focus:ring-red-900">
                        Sí, eliminar
                    </button>
                    <button (click)="closeDeleteModal()" type="button"
                        class="cursor-pointer text-gray-700 bg-white hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 border border-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 hover:text-gray-900 focus:outline-none dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600 dark:hover:text-white dark:focus:ring-gray-700">
                        No, cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="productModal" tabindex="-1" aria-hidden="true"
        class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-modal md:h-full">
        <div class="relative p-4 w-full max-w-4xl h-full md:h-auto">
            <div class="relative bg-white rounded-lg shadow dark:bg-gray-800 p-4 sm:p-5">
                <!-- Modal header -->
                <div class="flex justify-between items-center pb-4 mb-4 rounded-t border-b border-gray-200 sm:mb-5 dark:border-gray-600">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                        {{ isEditMode ? 'Editar Producto' : 'Agregar Producto' }}
                    </h3>
                    <button type="button" (click)="closeModal()"
                        class="cursor-pointer text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white">
                        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                clip-rule="evenodd"></path>
                        </svg>
                        <span class="sr-only">Cerrar modal</span>
                    </button>
                </div>

                <!-- Modal body -->
                <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
                    <div class="grid gap-4 mb-4 grid-cols-2">
                        <!-- Nombre -->
                        <div>
                            <label for="nombre" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                Nombre del Producto <span class="text-red-600">*</span>
                            </label>
                            <input type="text" id="nombre" formControlName="nombre"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                [class.border-red-500]="productForm.get('nombre')?.invalid && productForm.get('nombre')?.touched"
                                placeholder="Ej: Sofá de Cuero Moderno" />
                            @if (productForm.get('nombre')?.invalid && productForm.get('nombre')?.touched) {
                            <p class="mt-1 text-sm text-red-600 dark:text-red-500">
                                @if (productForm.get('nombre')?.errors?.['required']) {
                                El nombre es requerido
                                }
                            </p>
                            }
                        </div>

                        <!-- Código -->
                        <div>
                            <label for="codigo" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                Código del Producto (SKU) <span class="text-red-600">*</span>
                            </label>
                            <input type="text" id="codigo" formControlName="codigo"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                [class.border-red-500]="productForm.get('codigo')?.invalid && productForm.get('codigo')?.touched"
                                placeholder="Ej: OL|P-2023-001" />
                            @if (productForm.get('codigo')?.invalid && productForm.get('codigo')?.touched) {
                            <p class="mt-1 text-sm text-red-600 dark:text-red-500">
                                Código requerido
                            </p>
                            }
                        </div>

                        <!-- Precio -->
                        <div>
                            <label for="precio" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                Precio <span class="text-red-600">*</span>
                            </label>
                            <input type="number" step="0.01" id="precio" formControlName="precio"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                [class.border-red-500]="productForm.get('precio')?.invalid && productForm.get('precio')?.touched"
                                placeholder="$ 0.00" />
                            @if (productForm.get('precio')?.invalid && productForm.get('precio')?.touched) {
                            <p class="mt-1 text-sm text-red-600 dark:text-red-500">
                                Precio debe ser mayor a 0
                            </p>
                            }
                        </div>

                        <!-- Stock -->
                        <div>
                            <label for="stock" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                Cantidad de Stock <span class="text-red-600">*</span>
                            </label>
                            <input type="number" id="stock" formControlName="stock"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                [class.border-red-500]="productForm.get('stock')?.invalid && productForm.get('stock')?.touched"
                                placeholder="0" />
                            @if (productForm.get('stock')?.invalid && productForm.get('stock')?.touched) {
                            <p class="mt-1 text-sm text-red-600 dark:text-red-500">
                                Stock debe ser mayor o igual a 0
                            </p>
                            }
                        </div>

                        <!-- Categoría -->
                        <div>
                            <label for="categoria" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                Categoría <span class="text-red-600">*</span>
                            </label>
                            <select id="categoria" formControlName="categoria"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                [class.border-red-500]="productForm.get('categoria')?.invalid && productForm.get('categoria')?.touched">
                                <option value="">Seleccionar Categoría</option>
                                @for (category of categories; track category._id) {
                                <option [value]="category._id">{{ category.nombre }}</option>
                                }
                            </select>
                            @if (productForm.get('categoria')?.invalid && productForm.get('categoria')?.touched) {
                            <p class="mt-1 text-sm text-red-600 dark:text-red-500">
                                Categoría requerida
                            </p>
                            }
                        </div>

                        <!-- Marca -->
                        <div>
                            <label for="marca" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                Marca <span class="text-red-600">*</span>
                            </label>
                            <select id="marca" formControlName="marca"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                [class.border-red-500]="productForm.get('marca')?.invalid && productForm.get('marca')?.touched">
                                <option value="">Seleccionar Marca</option>
                                @for (brand of brands; track brand._id) {
                                <option [value]="brand._id">{{ brand.nombre }}</option>
                                }
                            </select>
                            @if (productForm.get('marca')?.invalid && productForm.get('marca')?.touched) {
                            <p class="mt-1 text-sm text-red-600 dark:text-red-500">
                                Marca requerida
                            </p>
                            }
                        </div>

                        <!-- Descripción -->
                        <div class="col-span-2">
                            <label for="descripcion"
                                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                Descripción del Producto
                            </label>
                            <textarea id="descripcion" formControlName="descripcion" rows="3"
                                class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                placeholder="Describe las características, materiales e instrucciones del producto..."></textarea>
                        </div>

                        <!-- Tallas -->
                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                Tallas Disponibles
                            </label>
                            <input type="text" id="tallas" formControlName="tallas"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                placeholder="S, M, L, XL" />
                        </div>

                        <!-- Colores -->
                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                Colores Disponibles
                            </label>
                            <input type="text" id="colores" formControlName="colores"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 placeholder-gray-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                placeholder="Rojo, Azul, Negro" />
                        </div>

                        <!-- Upload de Imagen -->
                        <div class="col-span-2">
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                Imágenes del Producto
                            </label>
                            <div class="flex items-center justify-center w-full">
                                <label for="dropzone-file"
                                    class="cursor-pointer flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg bg-gray-50 hover:bg-gray-100 dark:bg-gray-700 dark:border-gray-600 dark:hover:bg-gray-600">
                                    @if (imagePreview) {
                                    <div class="relative w-full h-full">
                                        <img [src]="imagePreview" alt="Preview" class="w-full h-full object-contain rounded-lg p-2">
                                        <button type="button" (click)="removeImage($event)"
                                            class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    } @else {
                                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                        <svg class="w-8 h-8 mb-3 text-primary-500" aria-hidden="true"
                                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2" />
                                        </svg>
                                        <p class="mb-1 text-sm text-gray-500 dark:text-gray-400">
                                            <span class="font-semibold">Clic para subir</span> o arrastra y suelta
                                        </p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">PNG, JPG o JPEG (MÁX. 5MB)</p>
                                    </div>
                                    }
                                    <input id="dropzone-file" type="file" class="hidden" accept="image/*"
                                        (change)="onFileSelected($event)" />
                                </label>
                            </div>
                            @if (uploadProgress > 0 && uploadProgress < 100) {
                            <div class="mt-2">
                                <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">
                                    <div class="bg-primary-600 h-2.5 rounded-full" [style.width.%]="uploadProgress"></div>
                                </div>
                            </div>
                            }
                        </div>
                    </div>

                    <!-- Botones -->
                    <div class="flex items-center justify-end space-x-3 mt-4">
                        <button type="button" (click)="closeModal()"
                            class="cursor-pointer text-gray-700 inline-flex items-center hover:text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:border-gray-600 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-700">
                            Cancelar
                        </button>
                        <button type="submit" [disabled]="isUploading"
                            class="cursor-pointer text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800 disabled:opacity-50 disabled:cursor-not-allowed">
                            {{ isEditMode ? 'Actualizar Producto' : 'Guardar Producto' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>